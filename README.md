# School Cream - æ™ºèƒ½è¯¾å ‚ç›‘æ§ç³»ç»Ÿ

ä¸€ä¸ªåŸºäºæ·±åº¦å­¦ä¹ çš„æ™ºèƒ½è¯¾å ‚ç›‘æ§ç³»ç»Ÿï¼Œç”¨äºå®æ—¶æ£€æµ‹å’Œåˆ†æè¯¾å ‚ä¸­çš„å­¦ç”Ÿè¡Œä¸ºï¼ŒåŒ…æ‹¬ä¸¾æ‰‹ã€èººå§ã€æ‰‹æœºä½¿ç”¨ç­‰è¡Œä¸ºæ£€æµ‹ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **å¤šç›®æ ‡è¡Œä¸ºæ£€æµ‹**ï¼šä¸¾æ‰‹ã€äººå‘˜ã€èººå§ã€æ‰‹æœºä½¿ç”¨æ£€æµ‹
- **å®æ—¶è§†é¢‘å¤„ç†**ï¼šæ”¯æŒRTSPæµå’Œæœ¬åœ°è§†é¢‘æ–‡ä»¶
- **æ™ºèƒ½è¯¾ç¨‹ç®¡ç†**ï¼šä»æ³¨å†Œä¸­å¿ƒAPIè·å–è¯¾ç¨‹ä¿¡æ¯
- **å§¿æ€åˆ†æ**ï¼šåŸºäºMediaPipeçš„äººä½“å§¿æ€å…³é”®ç‚¹æå–
- **å¼‚å¸¸è¡Œä¸ºæ£€æµ‹**ï¼šä½¿ç”¨LSTMè‡ªç¼–ç å™¨æ£€æµ‹æ‰‹æœºä½¿ç”¨è¡Œä¸º
- **å¤šçº¿ç¨‹å¤„ç†**ï¼šç¡®ä¿å®æ—¶æ€§å’Œæµç•…æ€§

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- CUDA 11.0+ (æ¨èï¼Œç”¨äºGPUåŠ é€Ÿ)
- 8GB+ RAM
- æ”¯æŒOpenCVçš„æ‘„åƒå¤´æˆ–è§†é¢‘æ–‡ä»¶

## ğŸ› ï¸ å®‰è£…è¯´æ˜

### æœ¬åœ°å®‰è£…

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd school_cream
```

2. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
```bash
conda create -n school python=3.8
conda activate school
```

3. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

4. **ä¸‹è½½æ¨¡å‹æ–‡ä»¶**
ç¡®ä¿ `models/` ç›®å½•åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
- `best.pt` æˆ– `yolo11n.pt` - YOLOæ£€æµ‹æ¨¡å‹
- `phone_detection_autoencoder.pth` - æ‰‹æœºæ£€æµ‹æ¨¡å‹
- `threshold.npy` - æ£€æµ‹é˜ˆå€¼æ–‡ä»¶

### Dockeréƒ¨ç½²

1. **æ„å»ºé•œåƒ**
```bash
docker build -t school-cream .
```

2. **è¿è¡Œå®¹å™¨**
```bash
docker run -d \
  --name school-cream \
  --gpus all \
  -p 8080:8080 \
  -v $(pwd)/models:/app/models \
  -v $(pwd)/output:/app/output \
  school-cream
```

3. **ä½¿ç”¨Docker Compose**
```bash
docker-compose up -d
```

## ğŸ® ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œä½¿ç”¨

```bash
python main.py --registry_url <API_URL> --max_frames <å¸§æ•°é™åˆ¶>
```

**å‚æ•°è¯´æ˜ï¼š**
- `--registry_url`ï¼šæ³¨å†Œä¸­å¿ƒAPIåœ°å€ï¼ˆå¿…éœ€ï¼‰
- `--max_frames`ï¼šæœ€å¤§å¤„ç†å¸§æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤æ— é™åˆ¶ï¼‰

**ç¤ºä¾‹ï¼š**
```bash
python main.py --registry_url "http://api.example.com/courses" --max_frames 1000
```

### APIè¯·æ±‚ç»“æ„

#### æ³¨å†Œä¸­å¿ƒAPIæ ¼å¼

ç³»ç»ŸæœŸæœ›ä»æ³¨å†Œä¸­å¿ƒAPIè·å–ä»¥ä¸‹JSONæ ¼å¼çš„æ•°æ®ï¼š

```json
[
  {
    "timeAdd": "14:30:00",
    "courseName": "é«˜ç­‰æ•°å­¦",
    "room_id": "A101",
    "device": [
      {
        "name": "å‰æ‘„åƒå¤´",
        "type": "camera",
        "liveUrl": "rtsp://192.168.1.100:554/stream1",
        "model_number": "IPC-123",
        "host": "192.168.1.100",
        "serial_number": "SN123456789",
        "token": "auth_token_here",
        "admin": "admin",
        "password": "password123",
        "create_by": "system",
        "create_date": "2024-01-01 00:00:00",
        "update_by": "admin",
        "update_date": "2024-01-01 00:00:00",
        "status": "1",
        "remarks": "å‰é—¨æ‘„åƒå¤´",
        "del_flag": "0"
      },
      {
        "name": "åæ‘„åƒå¤´",
        "type": "camera",
        "liveUrl": "rtsp://192.168.1.101:554/stream1",
        "model_number": "IPC-124",
        "host": "192.168.1.101",
        "serial_number": "SN123456790",
        "token": "auth_token_here",
        "admin": "admin",
        "password": "password123",
        "create_by": "system",
        "create_date": "2024-01-01 00:00:00",
        "update_by": "admin",
        "update_date": "2024-01-01 00:00:00",
        "status": "1",
        "remarks": "åé—¨æ‘„åƒå¤´",
        "del_flag": "0"
      }
    ]
  }
]
```

#### å­—æ®µè¯´æ˜

**è¯¾ç¨‹ä¿¡æ¯ï¼š**
- `timeAdd`ï¼šè¯¾ç¨‹æ—¶é—´ï¼ˆæ ¼å¼ï¼šHH:MM:SSï¼‰
- `courseName`ï¼šè¯¾ç¨‹åç§°
- `room_id`ï¼šæ•™å®¤ID

**è®¾å¤‡ä¿¡æ¯ï¼š**
- `name`ï¼šè®¾å¤‡åç§°
- `type`ï¼šè®¾å¤‡ç±»å‹ï¼ˆcameraï¼‰
- `liveUrl`ï¼šRTSPæµåœ°å€æˆ–è§†é¢‘æ–‡ä»¶è·¯å¾„
- `model_number`ï¼šè®¾å¤‡å‹å·
- `host`ï¼šè®¾å¤‡IPåœ°å€
- `serial_number`ï¼šè®¾å¤‡åºåˆ—å·
- `token`ï¼šè®¤è¯ä»¤ç‰Œ
- `admin`ï¼šç®¡ç†å‘˜ç”¨æˆ·å
- `password`ï¼šç®¡ç†å‘˜å¯†ç 
- `create_by`ï¼šåˆ›å»ºè€…
- `create_date`ï¼šåˆ›å»ºæ—¶é—´
- `update_by`ï¼šæ›´æ–°è€…
- `update_date`ï¼šæ›´æ–°æ—¶é—´
- `status`ï¼šè®¾å¤‡çŠ¶æ€ï¼ˆ1=å¯ç”¨ï¼Œ0=ç¦ç”¨ï¼‰
- `remarks`ï¼šå¤‡æ³¨ä¿¡æ¯
- `del_flag`ï¼šåˆ é™¤æ ‡å¿—ï¼ˆ0=æœªåˆ é™¤ï¼Œ1=å·²åˆ é™¤ï¼‰

## ğŸ“ è¾“å‡ºæ–‡ä»¶

ç³»ç»Ÿä¼šä¸ºæ¯ä¸ªè¯¾ç¨‹å’Œæ‘„åƒå¤´ç»„åˆç”Ÿæˆä¸€ä¸ªè§†é¢‘æ–‡ä»¶ï¼Œå‘½åæ ¼å¼ä¸ºï¼š
```
{æ—¶é—´}_{è¯¾ç¨‹åç§°}_{æ‘„åƒå¤´ä½ç½®}.mp4
```

ç¤ºä¾‹ï¼š`14-30-00_é«˜ç­‰æ•°å­¦_å‰æ‘„åƒå¤´.mp4`

## âš™ï¸ é…ç½®è¯´æ˜

### æ£€æµ‹é…ç½®

åœ¨ `config.py` ä¸­å¯ä»¥é…ç½®ä»¥ä¸‹å‚æ•°ï¼š

```python
DETECTION_CONFIG = {
    'conf_threshold': 0.5,      # æ£€æµ‹ç½®ä¿¡åº¦é˜ˆå€¼
    'max_det': 100,             # æœ€å¤§æ£€æµ‹æ•°é‡
    'update_interval': 0.1      # æ£€æµ‹æ›´æ–°é—´éš”ï¼ˆç§’ï¼‰
}
```

### æ¨¡å‹é…ç½®

ç³»ç»Ÿæ”¯æŒå¤šç§YOLOæ¨¡å‹ï¼ŒæŒ‰ä¼˜å…ˆçº§é€‰æ‹©ï¼š
1. `best.pt` - è‡ªå®šä¹‰è®­ç»ƒçš„æœ€ä½³æ¨¡å‹
2. `yolov12n.pt` - YOLOv12næ¨¡å‹
3. `yolo11n.pt` - YOLO11næ¨¡å‹

## ğŸ”§ å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„

```
school_cream/
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ config.py                  # é…ç½®æ–‡ä»¶
â”œâ”€â”€ models/                    # æ¨¡å‹æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ best.pt               # æœ€ä½³YOLOæ¨¡å‹
â”‚   â”œâ”€â”€ phone_detection_autoencoder.pth    # æ‰‹æœºæ£€æµ‹æ¨¡å‹
â”‚   â””â”€â”€ threshold.npy         # æ£€æµ‹é˜ˆå€¼
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â”œâ”€â”€ Dockerfile                # Dockeræ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml        # Dockerç¼–æ’æ–‡ä»¶
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
```

### æ ¸å¿ƒç±»è¯´æ˜

- `Autoencoder`ï¼šLSTMè‡ªç¼–ç å™¨ï¼Œç”¨äºæ‰‹æœºä½¿ç”¨æ£€æµ‹
- `SkeletonExtractor`ï¼šéª¨æ¶æå–å™¨ï¼ŒåŸºäºMediaPipe
- `VideoProcessor`ï¼šè§†é¢‘å¤„ç†å™¨ï¼Œæ•´åˆæ‰€æœ‰æ£€æµ‹åŠŸèƒ½

## ğŸ³ Dockeréƒ¨ç½²

### ç¯å¢ƒå˜é‡

å¯ä»¥é€šè¿‡ä»¥ä¸‹ç¯å¢ƒå˜é‡é…ç½®ç³»ç»Ÿï¼š

```bash
# æ¨¡å‹è·¯å¾„
MODEL_PATH=/app/models

# è¾“å‡ºè·¯å¾„
OUTPUT_PATH=/app/output

# æ£€æµ‹é…ç½®
CONF_THRESHOLD=0.5
MAX_DET=100
UPDATE_INTERVAL=0.1

# GPUé…ç½®
CUDA_VISIBLE_DEVICES=0
```

### æ•°æ®å·æŒ‚è½½

```bash
# æ¨¡å‹æ–‡ä»¶
-v /host/models:/app/models

# è¾“å‡ºæ–‡ä»¶
-v /host/output:/app/output

# é…ç½®æ–‡ä»¶
-v /host/config:/app/config
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

1. **GPUåŠ é€Ÿ**ï¼šä½¿ç”¨CUDAåŠ é€Ÿæ¨¡å‹æ¨ç†
2. **å¤šçº¿ç¨‹å¤„ç†**ï¼šæ£€æµ‹å’Œè§†é¢‘å¤„ç†åˆ†ç¦»
3. **å†…å­˜ç®¡ç†**ï¼šåŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¸§æ•°æ®
4. **æ¨¡å‹ä¼˜åŒ–**ï¼šä½¿ç”¨åŠç²¾åº¦æµ®ç‚¹æ•°å‡å°‘å†…å­˜å ç”¨

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨¡å‹åŠ è½½å¤±è´¥**
   - æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   - ç¡®è®¤æ¨¡å‹æ–‡ä»¶æ ¼å¼æ­£ç¡®

2. **RTSPè¿æ¥å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤RTSPåœ°å€å’Œè®¤è¯ä¿¡æ¯

3. **GPUå†…å­˜ä¸è¶³**
   - å‡å°‘æ‰¹å¤„ç†å¤§å°
   - ä½¿ç”¨CPUæ¨¡å¼

4. **æ£€æµ‹ç²¾åº¦ä½**
   - è°ƒæ•´ç½®ä¿¡åº¦é˜ˆå€¼
   - æ£€æŸ¥å…‰ç…§æ¡ä»¶

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒå››ç§è¡Œä¸ºæ£€æµ‹
- é›†æˆæ‰‹æœºä½¿ç”¨æ£€æµ‹
- æ”¯æŒRTSPæµå¤„ç†

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›é¡¹ç›®ã€‚

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚
